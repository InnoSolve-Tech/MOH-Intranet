<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Settings - Partner Management System</title>
    <link rel="stylesheet" href="../css/global.css" />
    <link rel="stylesheet" href="../css/dashboard.css" />
    <link rel="stylesheet" href="../css/settings.css" />
    <!-- Added jQuery and ag-grid for dropdown management -->
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/ag-grid-community@31.0.0/dist/ag-grid-community.min.js"></script>
  </head>
  <body>
    <div class="dashboard-container">
      <!-- Sidebar -->
      <div id="sidebar-container"></div>

      <!-- Completely rebuilt main content with individual cards for each dropdown type -->
      <main class="main-content">
        <header class="content-header">
          <h1>System Settings</h1>
          <div class="header-actions">
            <button class="btn btn-primary" onclick="saveAllSettings()">
              <svg
                width="16"
                height="16"
                viewBox="0 0 24 24"
                fill="currentColor"
              >
                <path
                  d="M17 3H5c-1.11 0-2 .9-2 2v14c0 1.1.89 2 2 2h14c1.11 0 2-.9 2-2V7l-4-4zm-5 16c-1.66 0-3-1.34-3-3s1.34-3 3-3 3 1.34 3 3-1.34 3-3 3zm3-10H5V5h10v4z"
                />
              </svg>
              Save Changes
            </button>
          </div>
        </header>

        <div class="content-body">
          <!-- New settings navigation with dropdown management and SMTP tabs -->
          <div class="settings-nav">
            <button
              class="nav-btn active"
              onclick="showSettingsSection('dropdowns')"
            >
              <svg
                width="16"
                height="16"
                viewBox="0 0 24 24"
                fill="currentColor"
              >
                <path d="M7 10l5 5 5-5z" />
              </svg>
              Dropdown Management
            </button>
            <!-- Added Internal Groups tab -->
            <button class="nav-btn" onclick="showSettingsSection('groups')">
              <svg
                width="16"
                height="16"
                viewBox="0 0 24 24"
                fill="currentColor"
              >
                <path
                  d="M16 4c0-1.11.89-2 2-2s2 .89 2 2-.89 2-2 2-2-.89-2-2zm4 18v-6h2.5l-2.54-7.63A3.01 3.01 0 0 0 16.5 6.5c-.83 0-1.58.34-2.12.89L12 10.5 9.62 7.39C9.08 6.84 8.33 6.5 7.5 6.5c-1.31 0-2.42.83-2.96 2.37L2 16.5H4.5V22h15z"
                />
              </svg>
              Internal Groups
            </button>
            <button class="nav-btn" onclick="showSettingsSection('bulk-email')">
              <svg
                viewBox="0 0 24 24"
                width="16"
                height="16"
                fill="currentColor"
                xmlns="http://www.w3.org/2000/svg"
              >
                <g id="SVGRepo_bgCarrier" stroke-width="0"></g>
                <g
                  id="SVGRepo_tracerCarrier"
                  stroke-linecap="round"
                  stroke-linejoin="round"
                ></g>
                <g id="SVGRepo_iconCarrier">
                  <path
                    d="M16 12C16 14.2091 14.2091 16 12 16C9.79086 16 8 14.2091 8 12C8 9.79086 9.79086 8 12 8C14.2091 8 16 9.79086 16 12ZM16 12V13.5C16 14.8807 17.1193 16 18.5 16V16C19.8807 16 21 14.8807 21 13.5V12C21 7.02944 16.9706 3 12 3C7.02944 3 3 7.02944 3 12C3 16.9706 7.02944 21 12 21H16"
                    stroke="#000000"
                    stroke-width="2"
                    stroke-linecap="round"
                    stroke-linejoin="round"
                  ></path>
                </g>
              </svg>
              Bulk Email
            </button>
            <button class="nav-btn" onclick="showSettingsSection('smtp')">
              <svg
                width="16"
                height="16"
                viewBox="0 0 24 24"
                fill="currentColor"
              >
                <path
                  d="M20 4H4c-1.1 0-1.99.9-1.99 2L2 18c0 1.1.9 2 2 2h16c1.1 0 2-.9 2-2V6c0-1.1-.9-2-2-2zm0 4l-8 5-8-5V6l8 5 8-5v2z"
                />
              </svg>
              SMTP Configuration
            </button>
            <button class="nav-btn" onclick="showSettingsSection('api-tokens')">
              <svg
                width="16"
                height="16"
                viewBox="0 0 24 24"
                fill="currentColor"
              >
                <path
                  d="M12 2a10 10 0 100 20 10 10 0 000-20zm1 14.93V20h-2v-3.07A8.001 8.001 0 014.07 13H1v-2h3.07A8.001 8.001 0 0111 4.07V1h2v3.07A8.001 8.001 0 0119.93 11H23v2h-3.07A8.001 8.001 0 0113 16.93z"
                />
              </svg>
              API Tokens
            </button>
          </div>

          <!-- Dropdown Management Section with Individual Cards -->
          <div id="dropdowns-settings" class="settings-section active">
            <div class="dropdown-cards-container">
              <!-- Thematic Areas Card -->
              <div class="dropdown-card">
                <div class="card-header">
                  <h3>Thematic Areas</h3>
                  <p>Manage thematic areas for partner support programs</p>
                </div>
                <div class="card-body">
                  <div class="add-item-form">
                    <div class="form-row">
                      <input
                        type="text"
                        id="newThematicArea"
                        placeholder="Enter new thematic area"
                      />
                      <button
                        type="button"
                        class="btn btn-primary"
                        onclick="addDropdownItem('thematicAreas')"
                      >
                        <svg
                          width="16"
                          height="16"
                          viewBox="0 0 24 24"
                          fill="currentColor"
                        >
                          <path d="M19 13h-6v6h-2v-6H5v-2h6V5h2v6h6v2z" />
                        </svg>
                        Add
                      </button>
                    </div>
                  </div>
                  <div
                    id="thematicAreasGrid"
                    class="ag-theme-alpine dropdown-grid"
                  ></div>
                </div>
              </div>

              <!-- Partner Categories Card -->
              <div class="dropdown-card">
                <div class="card-header">
                  <h3>Partner Categories</h3>
                  <p>Manage partner categories by type (Local/International)</p>
                </div>
                <div class="card-body">
                  <div class="add-item-form">
                    <div class="form-row">
                      <select id="categoryType">
                        <option value="Local">Local</option>
                        <option value="International">International</option>
                      </select>
                      <input
                        type="text"
                        id="newPartnerCategory"
                        placeholder="Enter new category"
                      />
                      <button
                        type="button"
                        class="btn btn-primary"
                        onclick="addDropdownItem('partnerCategories')"
                      >
                        <svg
                          width="16"
                          height="16"
                          viewBox="0 0 24 24"
                          fill="currentColor"
                        >
                          <path d="M19 13h-6v6h-2v-6H5v-2h6V5h2v6h6v2z" />
                        </svg>
                        Add
                      </button>
                    </div>
                  </div>
                  <div
                    id="partnerCategoriesGrid"
                    class="ag-theme-alpine dropdown-grid"
                  ></div>
                </div>
              </div>

              <!-- Districts Card -->
              <div class="dropdown-card">
                <div class="card-header">
                  <h3>Districts</h3>
                  <p>Manage Uganda districts for partner operations</p>
                </div>
                <div class="card-body">
                  <div class="add-item-form">
                    <div class="form-row">
                      <input
                        type="text"
                        id="newDistrict"
                        placeholder="Enter new district"
                      />
                      <button
                        type="button"
                        class="btn btn-primary"
                        onclick="addDropdownItem('districts')"
                      >
                        <svg
                          width="16"
                          height="16"
                          viewBox="0 0 24 24"
                          fill="currentColor"
                        >
                          <path d="M19 13h-6v6h-2v-6H5v-2h6V5h2v6h6v2z" />
                        </svg>
                        Add
                      </button>
                    </div>
                  </div>
                  <div
                    id="districtsGrid"
                    class="ag-theme-alpine dropdown-grid"
                  ></div>
                </div>
              </div>
            </div>
          </div>

          <!-- Internal Groups Section -->
          <div id="groups-settings" class="settings-section">
            <div class="settings-card">
              <div class="card-header">
                <h3>Internal Groups Management</h3>
                <p>
                  Create and manage internal groups to categorize partners based
                  on thematic areas or geographic regions
                </p>
              </div>
              <div class="card-body">
                <div class="add-group-form">
                  <div class="form-row">
                    <div class="form-group">
                      <input
                        type="text"
                        id="newGroupName"
                        placeholder="Group name (e.g., Health Partners East)"
                      />
                    </div>
                    <div class="form-group">
                      <input
                        type="text"
                        id="newGroupDescription"
                        placeholder="Group description"
                      />
                    </div>
                    <div class="form-group">
                      <button
                        type="button"
                        class="btn btn-primary"
                        onclick="addInternalGroup()"
                      >
                        <svg
                          width="16"
                          height="16"
                          viewBox="0 0 24 24"
                          fill="currentColor"
                        >
                          <path d="M19 13h-6v6h-2v-6H5v-2h6V5h2v6h6v2z" />
                        </svg>
                        Add Group
                      </button>
                    </div>
                  </div>
                </div>
                <div
                  id="internalGroupsGrid"
                  class="ag-theme-alpine"
                  style="height: 400px; width: 100%; margin-top: 20px"
                ></div>
              </div>
            </div>
          </div>
          <!-- Bulk Email Section -->
          <div id="bulk-email-settings" class="settings-section">
            <div class="settings-card">
              <div class="card-header">
                <h3>Bulk Email Communications</h3>
                <p>
                  Send targeted email campaigns to partners based on thematic
                  areas or internal groups
                </p>
              </div>
              <div class="card-body">
                <div class="bulk-email-form">
                  <div class="form-row">
                    <div class="form-group">
                      <label for="emailTargetType">Target Audience</label>
                      <select
                        id="emailTargetType"
                        onchange="updateEmailTargets()"
                      >
                        <option value="">Select target type...</option>
                        <option value="thematic">By Thematic Area</option>
                        <option value="group">By Internal Group</option>
                        <option value="all">All Partners</option>
                      </select>
                    </div>
                    <div
                      class="form-group"
                      id="emailTargetSelectionGroup"
                      style="display: none"
                    >
                      <label
                        for="emailTargetSelection"
                        id="emailTargetSelectionLabel"
                        >Select Target</label
                      >
                      <select id="emailTargetSelection" multiple>
                        <!-- Options populated dynamically -->
                      </select>
                      <small>Hold Ctrl/Cmd to select multiple options</small>
                    </div>
                  </div>

                  <div class="form-row">
                    <div class="form-group">
                      <label for="emailSubject">Email Subject *</label>
                      <input
                        type="text"
                        id="emailSubject"
                        placeholder="Enter email subject line"
                        required
                      />
                    </div>
                    <div class="form-group">
                      <label for="emailPriority">Priority</label>
                      <select id="emailPriority">
                        <option value="normal">Normal</option>
                        <option value="high">High</option>
                        <option value="low">Low</option>
                      </select>
                    </div>
                  </div>

                  <div class="form-group">
                    <label for="emailContent">Email Content *</label>
                    <textarea
                      id="emailContent"
                      rows="10"
                      placeholder="Enter your email message here..."
                      required
                    ></textarea>
                  </div>

                  <div class="email-templates">
                    <h4>Quick Templates</h4>
                    <div class="template-buttons">
                      <button
                        type="button"
                        class="btn btn-secondary btn-sm"
                        onclick="loadEmailTemplate('survey')"
                      >
                        Survey Request
                      </button>
                      <button
                        type="button"
                        class="btn btn-secondary btn-sm"
                        onclick="loadEmailTemplate('update')"
                      >
                        Program Update
                      </button>
                      <button
                        type="button"
                        class="btn btn-secondary btn-sm"
                        onclick="loadEmailTemplate('meeting')"
                      >
                        Meeting Invitation
                      </button>
                      <button
                        type="button"
                        class="btn btn-secondary btn-sm"
                        onclick="loadEmailTemplate('reminder')"
                      >
                        Document Reminder
                      </button>
                    </div>
                  </div>

                  <div class="email-actions">
                    <div class="action-buttons">
                      <button
                        type="button"
                        class="btn btn-primary"
                        onclick="sendBulkEmail()"
                      >
                        <svg
                          width="16"
                          height="16"
                          viewBox="0 0 24 24"
                          fill="currentColor"
                        >
                          <path d="M2.01 21L23 12 2.01 3 2 10l15 2-15 2z" />
                        </svg>
                        Send Email
                      </button>
                    </div>
                  </div>
                </div>
              </div>
            </div>

            <!-- Email History -->
            <div class="settings-card" style="margin-top: 20px">
              <div class="card-header">
                <h3>Email Campaign History</h3>
                <p>Track your previously sent bulk emails</p>
              </div>
              <div class="card-body">
                <div
                  id="emailHistoryGrid"
                  class="ag-theme-alpine"
                  style="height: 300px; width: 100%"
                ></div>
              </div>
            </div>
          </div>

          <!-- SMTP Configuration Section -->
          <div id="smtp-settings" class="settings-section">
            <div class="settings-card">
              <div class="card-header">
                <h3>SMTP Configuration</h3>
                <p>Configure email server settings for system notifications</p>
              </div>
              <div class="card-body">
                <div class="form-row">
                  <div class="form-group">
                    <label for="smtpHost">SMTP Host *</label>
                    <input
                      type="text"
                      id="smtpHost"
                      name="smtpHost"
                      placeholder="smtp.gmail.com"
                      required
                    />
                  </div>
                  <div class="form-group">
                    <label for="smtpPort">SMTP Port *</label>
                    <input
                      type="number"
                      id="smtpPort"
                      name="smtpPort"
                      placeholder="587"
                      required
                    />
                  </div>
                </div>

                <div class="form-row">
                  <div class="form-group">
                    <label for="smtpUsername">Username *</label>
                    <input
                      type="email"
                      id="smtpUsername"
                      name="smtpUsername"
                      placeholder="your-email@gmail.com"
                      required
                    />
                  </div>
                  <div class="form-group">
                    <label for="smtpPassword">Password *</label>
                    <input
                      type="password"
                      id="smtpPassword"
                      name="smtpPassword"
                      placeholder="••••••••"
                      required
                    />
                  </div>
                </div>

                <div class="form-row">
                  <div class="form-group">
                    <label for="smtpSecurity">Security</label>
                    <select id="smtpSecurity" name="smtpSecurity">
                      <option value="tls">TLS</option>
                      <option value="ssl">SSL</option>
                      <option value="none">None</option>
                    </select>
                  </div>
                  <div class="form-group">
                    <label for="smtpFromName">From Name</label>
                    <input
                      type="text"
                      id="smtpFromName"
                      name="smtpFromName"
                      placeholder="Ministry of Health Uganda"
                    />
                  </div>
                </div>

                <div class="form-group">
                  <label for="smtpFromEmail">From Email</label>
                  <input
                    type="email"
                    id="smtpFromEmail"
                    name="smtpFromEmail"
                    placeholder="noreply@health.go.ug"
                  />
                </div>

                <!-- Test SMTP Connection -->
                <div class="smtp-test-section">
                  <h4>Test SMTP Connection</h4>
                  <div class="form-row">
                    <div class="form-group">
                      <input
                        type="email"
                        id="testEmail"
                        placeholder="Enter test email address"
                      />
                    </div>
                    <div class="form-group">
                      <button
                        type="button"
                        class="btn btn-secondary"
                        onclick="testSmtpConnection()"
                      >
                        <svg
                          width="16"
                          height="16"
                          viewBox="0 0 24 24"
                          fill="currentColor"
                        >
                          <path
                            d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-2 15l-5-5 1.41-1.41L10 14.17l7.59-7.59L19 8l-9 9z"
                          />
                        </svg>
                        Send Test Email
                      </button>
                    </div>
                  </div>
                </div>

                <!-- Email Notification Settings -->
                <div class="notification-settings">
                  <h4>Email Notifications</h4>
                  <div class="checkbox-group">
                    <label class="checkbox-label">
                      <input
                        type="checkbox"
                        id="notifyNewPartner"
                        name="notifyNewPartner"
                        checked
                      />
                      <span class="checkmark"></span>
                      New partner registration
                    </label>
                  </div>
                  <div class="checkbox-group">
                    <label class="checkbox-label">
                      <input
                        type="checkbox"
                        id="notifyNewUser"
                        name="notifyNewUser"
                        checked
                      />
                      <span class="checkmark"></span>
                      New user account created
                    </label>
                  </div>
                  <div class="checkbox-group">
                    <label class="checkbox-label">
                      <input
                        type="checkbox"
                        id="notifyMouUpload"
                        name="notifyMouUpload"
                        checked
                      />
                      <span class="checkmark"></span>
                      MoU document uploaded
                    </label>
                  </div>
                  <div class="checkbox-group">
                    <label class="checkbox-label">
                      <input
                        type="checkbox"
                        id="notifySecurityAlert"
                        name="notifySecurityAlert"
                        checked
                      />
                      <span class="checkmark"></span>
                      Security alerts and suspicious activity
                    </label>
                  </div>
                </div>
              </div>
            </div>
          </div>
          <div id="api-tokens-settings" class="settings-section">
            <div class="settings-card">
              <div class="card-header">
                <h3>API Token Management</h3>
                <p>Generate and manage API tokens for integrations</p>
              </div>
              <div class="card-body">
                <!-- Generate New Token -->
                <div class="form-row">
                  <div class="form-group">
                    <input
                      type="text"
                      id="newTokenName"
                      placeholder="Token name (e.g., Partner API)"
                    />
                  </div>
                  <div class="form-group">
                    <button
                      type="button"
                      class="btn btn-primary"
                      onclick="generateApiToken()"
                    >
                      <svg
                        width="16"
                        height="16"
                        viewBox="0 0 24 24"
                        fill="currentColor"
                      >
                        <path d="M19 13h-6v6h-2v-6H5v-2h6V5h2v6h6v2z" />
                      </svg>
                      Generate Token
                    </button>
                  </div>
                </div>

                <!-- Token List -->
                <div
                  id="apiTokensGrid"
                  class="ag-theme-alpine"
                  style="height: 300px; width: 100%; margin-top: 20px"
                ></div>
              </div>
            </div>
          </div>
        </div>
      </main>
    </div>

    <!-- Added modal for editing dropdown items -->
    <div id="editItemModal" class="modal">
      <div class="modal-content">
        <div class="modal-header">
          <h3>Edit Item</h3>
          <span class="close" onclick="closeEditItemModal()">&times;</span>
        </div>
        <div class="modal-body">
          <div class="form-group">
            <label for="editItemValue">Item Value</label>
            <input type="text" id="editItemValue" required />
          </div>
        </div>
        <div class="modal-footer">
          <button
            type="button"
            class="btn btn-secondary"
            onclick="closeEditItemModal()"
          >
            Cancel
          </button>
          <button
            type="button"
            class="btn btn-primary"
            onclick="saveEditedItem()"
          >
            Save Changes
          </button>
        </div>
      </div>
    </div>

    <!-- Added modal for adding/editing internal groups -->
    <div id="groupModal" class="modal">
      <div class="modal-content">
        <div class="modal-header">
          <h3 id="groupModalTitle">Add Internal Group</h3>
          <span class="close" onclick="closeGroupModal()">&times;</span>
        </div>
        <div class="modal-body">
          <div class="form-group">
            <label for="groupName">Group Name *</label>
            <input
              type="text"
              id="groupName"
              placeholder="e.g., Health Partners East"
              required
            />
          </div>
          <div class="form-group">
            <label for="groupDescription">Description</label>
            <textarea
              id="groupDescription"
              rows="3"
              placeholder="Brief description of this group"
            ></textarea>
          </div>
          <div class="form-group">
            <label for="groupThematicAreas">Thematic Areas</label>
            <select id="groupThematicAreas" multiple>
              <option value="Health">Health</option>
              <option value="Education">Education</option>
              <option value="Agriculture">Agriculture</option>
              <option value="Water and Sanitation">Water and Sanitation</option>
              <option value="Nutrition">Nutrition</option>
              <option value="Child Protection">Child Protection</option>
              <option value="Gender Equality">Gender Equality</option>
              <option value="Environment">Environment</option>
              <option value="Economic Development">Economic Development</option>
              <option value="Emergency Response">Emergency Response</option>
              <option value="Governance">Governance</option>
              <option value="Human Rights">Human Rights</option>
            </select>
            <small>Hold Ctrl/Cmd to select multiple areas</small>
          </div>
          <div class="form-group">
            <label for="groupDistricts">Geographic Areas (Districts)</label>
            <select id="groupDistricts" multiple>
              <option value="Kampala">Kampala</option>
              <option value="Wakiso">Wakiso</option>
              <option value="Mukono">Mukono</option>
              <option value="Jinja">Jinja</option>
              <option value="Mbale">Mbale</option>
              <option value="Gulu">Gulu</option>
              <option value="Lira">Lira</option>
              <option value="Mbarara">Mbarara</option>
              <option value="Kasese">Kasese</option>
              <option value="Fort Portal">Fort Portal</option>
              <option value="Hoima">Hoima</option>
              <option value="Masaka">Masaka</option>
              <option value="Soroti">Soroti</option>
              <option value="Arua">Arua</option>
              <option value="Kabale">Kabale</option>
              <option value="Moroto">Moroto</option>
              <option value="Kitgum">Kitgum</option>
              <option value="Pader">Pader</option>
              <option value="Adjumani">Adjumani</option>
              <option value="Moyo">Moyo</option>
            </select>
            <small>Hold Ctrl/Cmd to select multiple districts</small>
          </div>
          <div class="form-group">
            <label for="groupColor">Group Color</label>
            <input type="color" id="groupColor" value="#3498db" />
            <small>Color for visual identification in reports and charts</small>
          </div>
        </div>
        <div class="modal-footer">
          <button
            type="button"
            class="btn btn-secondary"
            onclick="closeGroupModal()"
          >
            Cancel
          </button>
          <button
            type="button"
            class="btn btn-primary"
            onclick="saveInternalGroup()"
          >
            Save Group
          </button>
        </div>
      </div>
    </div>

    <script src="../js/dashboard.js"></script>
    <script src="../js/settings.js"></script>
  </body>
</html>
