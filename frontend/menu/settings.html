<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Settings - Partner Management System</title>
    <link rel="stylesheet" href="../css/global.css" />
    <link rel="stylesheet" href="../css/dashboard.css" />
    <link rel="stylesheet" href="../css/settings.css" />
    <!-- Added jQuery and ag-grid for dropdown management -->
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/ag-grid-community@31.0.0/dist/ag-grid-community.min.js"></script>
  </head>
  <body>
    <div class="dashboard-container">
      <!-- Sidebar -->
      <nav class="sidebar">
        <div class="sidebar-header">
          <center>
            <img
              src="../images/logo.png"
              width="100"
              height="100"
              alt="MoH logo"
            />
          </center>
        </div>
        <ul class="sidebar-menu">
          <li class="menu-item" data-page="partners">
            <a href="partners.html">
              <span class="menu-icon">
                <svg
                  width="16"
                  height="16"
                  viewBox="0 0 24 24"
                  fill="currentColor"
                >
                  <path
                    d="M16 4c0-1.11.89-2 2-2s2 .89 2 2-.89 2-2 2-2-.89-2-2zm4 18v-6h2.5l-2.54-7.63A2.996 2.996 0 0 0 17.06 7c-.8 0-1.54.5-1.85 1.26l-1.92 5.77c-.24.71.11 1.49.81 1.73.71.24 1.49-.11 1.73-.81L16.5 12H18v10h2zM12.5 11.5c.83 0 1.5-.67 1.5-1.5s-.67-1.5-1.5-1.5S11 9.17 11 10s.67 1.5 1.5 1.5zM5.5 6c1.11 0 2-.89 2-2s-.89-2-2-2-2 .89-2 2 .89 2 2 2zm1.5 2h-2C3.57 8 2.5 9.57 2.5 11.5V22h2v-6h2v6h2v-10.5C8.5 9.57 7.43 8 6 8z"
                  />
                </svg>
              </span>
              <span class="menu-text">Partners</span>
            </a>
          </li>

          <!-- ✅ Partner Profile -->
          <li class="menu-item" data-page="partner-profile">
            <a href="partner-profile.html">
              <span class="menu-icon">
                <svg
                  width="16"
                  height="16"
                  viewBox="0 0 24 24"
                  fill="currentColor"
                >
                  <path
                    d="M12 12c2.21 0 4-1.79 4-4S14.21 4 12 4 8 5.79 8 8s1.79 4 4 4zm0 2c-2.67 
              0-8 1.34-8 4v2h16v-2c0-2.66-5.33-4-8-4z"
                  />
                </svg>
              </span>
              <span class="menu-text">Partner Profile</span>
            </a>
          </li>

          <li class="menu-item" data-page="users">
            <a href="users.html">
              <span class="menu-icon">
                <svg
                  width="16"
                  height="16"
                  viewBox="0 0 24 24"
                  fill="currentColor"
                >
                  <path
                    d="M16 13c1.66 0 2.99-1.34 2.99-3S17.66 7 16 7s-3 1.34-3 3 
              1.34 3 3 3zm-8 0c1.66 0 2.99-1.34 2.99-3S9.66 7 8 7 
              5 8.34 5 10s1.34 3 3 3zm0 2c-2.33 0-7 1.17-7 
              3.5V20h14v-1.5c0-2.33-4.67-3.5-7-3.5zm8 
              0c-.29 0-.62.02-.97.05 1.16.84 1.97 
              1.97 1.97 3.45V20h6v-1.5c0-2.33-4.67-3.5-7-3.5z"
                  />
                </svg>
              </span>
              <span class="menu-text">Users</span>
            </a>
          </li>

          <!-- ✅ User Profile -->
          <li class="menu-item" data-page="user-profile">
            <a href="user-profile.html">
              <span class="menu-icon">
                <svg
                  width="16"
                  height="16"
                  viewBox="0 0 24 24"
                  fill="currentColor"
                >
                  <path
                    d="M12 12c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 
              1.79-4 4 1.79 4 4 4zm0 2c-2.67 
              0-8 1.34-8 4v2h16v-2c0-2.66-5.33-4-8-4z"
                  />
                </svg>
              </span>
              <span class="menu-text">User Profile</span>
            </a>
          </li>

          <li class="menu-item" data-page="reports">
            <a href="reports.html">
              <span class="menu-icon">
                <svg
                  width="20"
                  height="20"
                  viewBox="0 0 24 24"
                  fill="currentColor"
                >
                  <path
                    d="M19 3H5c-1.1 0-2 .9-2 2v14c0 
          1.1.9 2 2 2h14c1.1 0 2-.9 
          2-2V5c0-1.1-.9-2-2-2zM9 
          17H7v-7h2v7zm4 0h-2V7h2v10zm4 
          0h-2v-4h2v4z"
                  />
                </svg>
              </span>
              <span class="menu-text">Reports</span>
            </a>
          </li>

          <li class="menu-item active" data-page="settings">
            <a href="settings.html">
              <span class="menu-icon">
                <svg
                  width="16"
                  height="16"
                  viewBox="0 0 24 24"
                  fill="currentColor"
                >
                  <path
                    d="M19.14,12.94c0.04-0.3,0.06-0.61,
              0.06-0.94c0-0.32-0.02-0.64-0.07-0.94l2.03-1.58
              c0.18-0.14,0.23-0.41,0.12-0.61l-1.92-3.32
              c-0.12-0.22-0.37-0.29-0.59-0.22l-2.39,0.96
              c-0.5-0.38-1.03-0.7-1.62-0.94L14.4,2.81
              c-0.04-0.24-0.24-0.41-0.48-0.41h-3.84
              c-0.24,0-0.43,0.17-0.47,0.41L9.25,5.35
              C8.66,5.59,8.12,5.92,7.63,6.29L5.24,5.33
              c-0.22-0.08-0.47,0-0.59,0.22L2.74,8.87
              C2.62,9.08,2.66,9.34,2.86,9.48l2.03,1.58
              C4.84,11.36,4.82,11.69,4.82,12s0.02,0.64,
              0.07,0.94l-2.03,1.58c-0.18,0.14-0.23,0.41-0.12,0.61
              l1.92,3.32c0.12,0.22,0.37,0.29,0.59,0.22l2.39-0.96
              c0.5,0.38,1.03,0.7,1.62,0.94l0.36,2.54c0.05,0.24,
              0.24,0.41,0.48,0.41h3.84c0.24,0,0.44-0.17,0.47-0.41
              l0.36-2.54c0.59-0.24,1.13-0.56,1.62-0.94l2.39,0.96
              c0.22,0.08,0.47,0,0.59-0.22l1.92-3.32
              c0.12-0.22,0.07-0.47-0.12-0.61L19.14,12.94z
              M12,15.6c-1.98,0-3.6-1.62-3.6-3.6s1.62-3.6,
              3.6-3.6s3.6,1.62,3.6,3.6S13.98,15.6,12,15.6z"
                  />
                </svg>
              </span>
              <span class="menu-text">Settings</span>
            </a>
          </li>
        </ul>

        <div class="sidebar-footer">
          <button class="logout-btn" onclick="logout()">
            <span class="menu-icon">
              <svg
                width="16"
                height="16"
                viewBox="0 0 24 24"
                fill="currentColor"
              >
                <path
                  d="M17 7l-1.41 1.41L18.17 11H8v2h10.17l-2.58 
            2.58L17 17l5-5zM4 5h8V3H4c-1.1 
            0-2 .9-2 2v14c0 1.1.9 2 2 2h8v-2H4V5z"
                />
              </svg>
            </span>
            <span class="menu-text">Logout</span>
          </button>
        </div>
      </nav>

      <!-- Completely rebuilt main content with individual cards for each dropdown type -->
      <main class="main-content">
        <header class="content-header">
          <h1>System Settings</h1>
          <div class="header-actions">
            <button class="btn btn-primary" onclick="saveAllSettings()">
              <svg
                width="16"
                height="16"
                viewBox="0 0 24 24"
                fill="currentColor"
              >
                <path
                  d="M17 3H5c-1.11 0-2 .9-2 2v14c0 1.1.89 2 2 2h14c1.11 0 2-.9 2-2V7l-4-4zm-5 16c-1.66 0-3-1.34-3-3s1.34-3 3-3 3 1.34 3 3-1.34 3-3 3zm3-10H5V5h10v4z"
                />
              </svg>
              Save Changes
            </button>
          </div>
        </header>

        <div class="content-body">
          <!-- New settings navigation with dropdown management and SMTP tabs -->
          <div class="settings-nav">
            <button
              class="nav-btn active"
              onclick="showSettingsSection('dropdowns')"
            >
              <svg
                width="16"
                height="16"
                viewBox="0 0 24 24"
                fill="currentColor"
              >
                <path d="M7 10l5 5 5-5z" />
              </svg>
              Dropdown Management
            </button>
            <!-- Added Internal Groups tab -->
            <button class="nav-btn" onclick="showSettingsSection('groups')">
              <svg
                width="16"
                height="16"
                viewBox="0 0 24 24"
                fill="currentColor"
              >
                <path
                  d="M16 4c0-1.11.89-2 2-2s2 .89 2 2-.89 2-2 2-2-.89-2-2zm4 18v-6h2.5l-2.54-7.63A3.01 3.01 0 0 0 16.5 6.5c-.83 0-1.58.34-2.12.89L12 10.5 9.62 7.39C9.08 6.84 8.33 6.5 7.5 6.5c-1.31 0-2.42.83-2.96 2.37L2 16.5H4.5V22h15z"
                />
              </svg>
              Internal Groups
            </button>
            <button class="nav-btn" onclick="showSettingsSection('smtp')">
              <svg
                width="16"
                height="16"
                viewBox="0 0 24 24"
                fill="currentColor"
              >
                <path
                  d="M20 4H4c-1.1 0-1.99.9-1.99 2L2 18c0 1.1.9 2 2 2h16c1.1 0 2-.9 2-2V6c0-1.1-.9-2-2-2zm0 4l-8 5-8-5V6l8 5 8-5v2z"
                />
              </svg>
              SMTP Configuration
            </button>
          </div>

          <!-- Dropdown Management Section with Individual Cards -->
          <div id="dropdowns-settings" class="settings-section active">
            <div class="dropdown-cards-container">
              <!-- Thematic Areas Card -->
              <div class="dropdown-card">
                <div class="card-header">
                  <h3>Thematic Areas</h3>
                  <p>Manage thematic areas for partner support programs</p>
                </div>
                <div class="card-body">
                  <div class="add-item-form">
                    <div class="form-row">
                      <input
                        type="text"
                        id="newThematicArea"
                        placeholder="Enter new thematic area"
                      />
                      <button
                        type="button"
                        class="btn btn-primary"
                        onclick="addDropdownItem('thematicAreas')"
                      >
                        <svg
                          width="16"
                          height="16"
                          viewBox="0 0 24 24"
                          fill="currentColor"
                        >
                          <path d="M19 13h-6v6h-2v-6H5v-2h6V5h2v6h6v2z" />
                        </svg>
                        Add
                      </button>
                    </div>
                  </div>
                  <div
                    id="thematicAreasGrid"
                    class="ag-theme-alpine dropdown-grid"
                  ></div>
                </div>
              </div>

              <!-- Partner Categories Card -->
              <div class="dropdown-card">
                <div class="card-header">
                  <h3>Partner Categories</h3>
                  <p>Manage partner categories by type (Local/International)</p>
                </div>
                <div class="card-body">
                  <div class="add-item-form">
                    <div class="form-row">
                      <select id="categoryType">
                        <option value="Local">Local</option>
                        <option value="International">International</option>
                      </select>
                      <input
                        type="text"
                        id="newPartnerCategory"
                        placeholder="Enter new category"
                      />
                      <button
                        type="button"
                        class="btn btn-primary"
                        onclick="addDropdownItem('partnerCategories')"
                      >
                        <svg
                          width="16"
                          height="16"
                          viewBox="0 0 24 24"
                          fill="currentColor"
                        >
                          <path d="M19 13h-6v6h-2v-6H5v-2h6V5h2v6h6v2z" />
                        </svg>
                        Add
                      </button>
                    </div>
                  </div>
                  <div
                    id="partnerCategoriesGrid"
                    class="ag-theme-alpine dropdown-grid"
                  ></div>
                </div>
              </div>

              <!-- Districts Card -->
              <div class="dropdown-card">
                <div class="card-header">
                  <h3>Districts</h3>
                  <p>Manage Uganda districts for partner operations</p>
                </div>
                <div class="card-body">
                  <div class="add-item-form">
                    <div class="form-row">
                      <input
                        type="text"
                        id="newDistrict"
                        placeholder="Enter new district"
                      />
                      <button
                        type="button"
                        class="btn btn-primary"
                        onclick="addDropdownItem('districts')"
                      >
                        <svg
                          width="16"
                          height="16"
                          viewBox="0 0 24 24"
                          fill="currentColor"
                        >
                          <path d="M19 13h-6v6h-2v-6H5v-2h6V5h2v6h6v2z" />
                        </svg>
                        Add
                      </button>
                    </div>
                  </div>
                  <div
                    id="districtsGrid"
                    class="ag-theme-alpine dropdown-grid"
                  ></div>
                </div>
              </div>

              <!-- Support Levels Card -->
              <div class="dropdown-card">
                <div class="card-header">
                  <h3>Support Levels</h3>
                  <p>Manage support levels for partner programs</p>
                </div>
                <div class="card-body">
                  <div class="add-item-form">
                    <div class="form-row">
                      <input
                        type="text"
                        id="newSupportLevel"
                        placeholder="Enter new support level"
                      />
                      <button
                        type="button"
                        class="btn btn-primary"
                        onclick="addDropdownItem('supportLevels')"
                      >
                        <svg
                          width="16"
                          height="16"
                          viewBox="0 0 24 24"
                          fill="currentColor"
                        >
                          <path d="M19 13h-6v6h-2v-6H5v-2h6V5h2v6h6v2z" />
                        </svg>
                        Add
                      </button>
                    </div>
                  </div>
                  <div
                    id="supportLevelsGrid"
                    class="ag-theme-alpine dropdown-grid"
                  ></div>
                </div>
              </div>
            </div>
          </div>

          <!-- Internal Groups Section -->
          <div id="groups-settings" class="settings-section">
            <div class="settings-card">
              <div class="card-header">
                <h3>Internal Groups Management</h3>
                <p>
                  Create and manage internal groups to categorize partners based
                  on thematic areas or geographic regions
                </p>
              </div>
              <div class="card-body">
                <div class="add-group-form">
                  <div class="form-row">
                    <div class="form-group">
                      <input
                        type="text"
                        id="newGroupName"
                        placeholder="Group name (e.g., Health Partners East)"
                      />
                    </div>
                    <div class="form-group">
                      <input
                        type="text"
                        id="newGroupDescription"
                        placeholder="Group description"
                      />
                    </div>
                    <div class="form-group">
                      <button
                        type="button"
                        class="btn btn-primary"
                        onclick="addInternalGroup()"
                      >
                        <svg
                          width="16"
                          height="16"
                          viewBox="0 0 24 24"
                          fill="currentColor"
                        >
                          <path d="M19 13h-6v6h-2v-6H5v-2h6V5h2v6h6v2z" />
                        </svg>
                        Add Group
                      </button>
                    </div>
                  </div>
                </div>
                <div
                  id="internalGroupsGrid"
                  class="ag-theme-alpine"
                  style="height: 400px; width: 100%; margin-top: 20px"
                ></div>
              </div>
            </div>
          </div>

          <!-- SMTP Configuration Section -->
          <div id="smtp-settings" class="settings-section">
            <div class="settings-card">
              <div class="card-header">
                <h3>SMTP Configuration</h3>
                <p>Configure email server settings for system notifications</p>
              </div>
              <div class="card-body">
                <div class="form-row">
                  <div class="form-group">
                    <label for="smtpHost">SMTP Host *</label>
                    <input
                      type="text"
                      id="smtpHost"
                      name="smtpHost"
                      placeholder="smtp.gmail.com"
                      required
                    />
                  </div>
                  <div class="form-group">
                    <label for="smtpPort">SMTP Port *</label>
                    <input
                      type="number"
                      id="smtpPort"
                      name="smtpPort"
                      placeholder="587"
                      required
                    />
                  </div>
                </div>

                <div class="form-row">
                  <div class="form-group">
                    <label for="smtpUsername">Username *</label>
                    <input
                      type="email"
                      id="smtpUsername"
                      name="smtpUsername"
                      placeholder="your-email@gmail.com"
                      required
                    />
                  </div>
                  <div class="form-group">
                    <label for="smtpPassword">Password *</label>
                    <input
                      type="password"
                      id="smtpPassword"
                      name="smtpPassword"
                      placeholder="••••••••"
                      required
                    />
                  </div>
                </div>

                <div class="form-row">
                  <div class="form-group">
                    <label for="smtpSecurity">Security</label>
                    <select id="smtpSecurity" name="smtpSecurity">
                      <option value="tls">TLS</option>
                      <option value="ssl">SSL</option>
                      <option value="none">None</option>
                    </select>
                  </div>
                  <div class="form-group">
                    <label for="smtpFromName">From Name</label>
                    <input
                      type="text"
                      id="smtpFromName"
                      name="smtpFromName"
                      placeholder="Ministry of Health Uganda"
                    />
                  </div>
                </div>

                <div class="form-group">
                  <label for="smtpFromEmail">From Email</label>
                  <input
                    type="email"
                    id="smtpFromEmail"
                    name="smtpFromEmail"
                    placeholder="noreply@health.go.ug"
                  />
                </div>

                <!-- Test SMTP Connection -->
                <div class="smtp-test-section">
                  <h4>Test SMTP Connection</h4>
                  <div class="form-row">
                    <div class="form-group">
                      <input
                        type="email"
                        id="testEmail"
                        placeholder="Enter test email address"
                      />
                    </div>
                    <div class="form-group">
                      <button
                        type="button"
                        class="btn btn-secondary"
                        onclick="testSmtpConnection()"
                      >
                        <svg
                          width="16"
                          height="16"
                          viewBox="0 0 24 24"
                          fill="currentColor"
                        >
                          <path
                            d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-2 15l-5-5 1.41-1.41L10 14.17l7.59-7.59L19 8l-9 9z"
                          />
                        </svg>
                        Send Test Email
                      </button>
                    </div>
                  </div>
                </div>

                <!-- Email Notification Settings -->
                <div class="notification-settings">
                  <h4>Email Notifications</h4>
                  <div class="checkbox-group">
                    <label class="checkbox-label">
                      <input
                        type="checkbox"
                        id="notifyNewPartner"
                        name="notifyNewPartner"
                        checked
                      />
                      <span class="checkmark"></span>
                      New partner registration
                    </label>
                  </div>
                  <div class="checkbox-group">
                    <label class="checkbox-label">
                      <input
                        type="checkbox"
                        id="notifyNewUser"
                        name="notifyNewUser"
                        checked
                      />
                      <span class="checkmark"></span>
                      New user account created
                    </label>
                  </div>
                  <div class="checkbox-group">
                    <label class="checkbox-label">
                      <input
                        type="checkbox"
                        id="notifyMouUpload"
                        name="notifyMouUpload"
                        checked
                      />
                      <span class="checkmark"></span>
                      MoU document uploaded
                    </label>
                  </div>
                  <div class="checkbox-group">
                    <label class="checkbox-label">
                      <input
                        type="checkbox"
                        id="notifySecurityAlert"
                        name="notifySecurityAlert"
                        checked
                      />
                      <span class="checkmark"></span>
                      Security alerts and suspicious activity
                    </label>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </main>
    </div>

    <!-- Added modal for editing dropdown items -->
    <div id="editItemModal" class="modal">
      <div class="modal-content">
        <div class="modal-header">
          <h3>Edit Item</h3>
          <span class="close" onclick="closeEditItemModal()">&times;</span>
        </div>
        <div class="modal-body">
          <div class="form-group">
            <label for="editItemValue">Item Value</label>
            <input type="text" id="editItemValue" required />
          </div>
        </div>
        <div class="modal-footer">
          <button
            type="button"
            class="btn btn-secondary"
            onclick="closeEditItemModal()"
          >
            Cancel
          </button>
          <button
            type="button"
            class="btn btn-primary"
            onclick="saveEditedItem()"
          >
            Save Changes
          </button>
        </div>
      </div>
    </div>

    <!-- Added modal for adding/editing internal groups -->
    <div id="groupModal" class="modal">
      <div class="modal-content">
        <div class="modal-header">
          <h3 id="groupModalTitle">Add Internal Group</h3>
          <span class="close" onclick="closeGroupModal()">&times;</span>
        </div>
        <div class="modal-body">
          <div class="form-group">
            <label for="groupName">Group Name *</label>
            <input
              type="text"
              id="groupName"
              placeholder="e.g., Health Partners East"
              required
            />
          </div>
          <div class="form-group">
            <label for="groupDescription">Description</label>
            <textarea
              id="groupDescription"
              rows="3"
              placeholder="Brief description of this group"
            ></textarea>
          </div>
          <div class="form-group">
            <label for="groupThematicAreas">Thematic Areas</label>
            <select id="groupThematicAreas" multiple>
              <option value="Health">Health</option>
              <option value="Education">Education</option>
              <option value="Agriculture">Agriculture</option>
              <option value="Water and Sanitation">Water and Sanitation</option>
              <option value="Nutrition">Nutrition</option>
              <option value="Child Protection">Child Protection</option>
              <option value="Gender Equality">Gender Equality</option>
              <option value="Environment">Environment</option>
              <option value="Economic Development">Economic Development</option>
              <option value="Emergency Response">Emergency Response</option>
              <option value="Governance">Governance</option>
              <option value="Human Rights">Human Rights</option>
            </select>
            <small>Hold Ctrl/Cmd to select multiple areas</small>
          </div>
          <div class="form-group">
            <label for="groupDistricts">Geographic Areas (Districts)</label>
            <select id="groupDistricts" multiple>
              <option value="Kampala">Kampala</option>
              <option value="Wakiso">Wakiso</option>
              <option value="Mukono">Mukono</option>
              <option value="Jinja">Jinja</option>
              <option value="Mbale">Mbale</option>
              <option value="Gulu">Gulu</option>
              <option value="Lira">Lira</option>
              <option value="Mbarara">Mbarara</option>
              <option value="Kasese">Kasese</option>
              <option value="Fort Portal">Fort Portal</option>
              <option value="Hoima">Hoima</option>
              <option value="Masaka">Masaka</option>
              <option value="Soroti">Soroti</option>
              <option value="Arua">Arua</option>
              <option value="Kabale">Kabale</option>
              <option value="Moroto">Moroto</option>
              <option value="Kitgum">Kitgum</option>
              <option value="Pader">Pader</option>
              <option value="Adjumani">Adjumani</option>
              <option value="Moyo">Moyo</option>
            </select>
            <small>Hold Ctrl/Cmd to select multiple districts</small>
          </div>
          <div class="form-group">
            <label for="groupColor">Group Color</label>
            <input type="color" id="groupColor" value="#3498db" />
            <small>Color for visual identification in reports and charts</small>
          </div>
        </div>
        <div class="modal-footer">
          <button
            type="button"
            class="btn btn-secondary"
            onclick="closeGroupModal()"
          >
            Cancel
          </button>
          <button
            type="button"
            class="btn btn-primary"
            onclick="saveInternalGroup()"
          >
            Save Group
          </button>
        </div>
      </div>
    </div>

    <script src="../js/dashboard.js"></script>
    <script src="../js/settings.js"></script>
  </body>
</html>
