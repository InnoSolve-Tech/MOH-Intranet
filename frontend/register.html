<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Partner Registration - Ministry of Health Uganda</title>
    <!-- Added global.css import before specific styles -->
    <link rel="stylesheet" href="css/global.css" />
    <link rel="stylesheet" href="css/register.css" />
  </head>
  <body>
    <!-- Combined branding and stepper into a single header at the top -->
    <div class="page-header">
      <div class="branding-header">
        <div class="logo-section">
          <img
            src="./images/logo.png?height=60&width=60"
            alt="Ministry of Health Uganda"
            class="ministry-logo"
            onclick="window.location.href='/'"
          />
          <div class="branding-text">
            <h1>Ministry of Health Uganda</h1>
            <p>Partner Registration System</p>
          </div>
        </div>
      </div>

      <div class="stepper-container">
        <div class="stepper">
          <div class="step active" data-step="1">
            <div class="step-number">1</div>
            <div class="step-title">Basic Info</div>
          </div>
          <div class="step" data-step="2">
            <div class="step-number">2</div>
            <div class="step-title">Contacts</div>
          </div>
          <div class="step" data-step="3">
            <div class="step-number">3</div>
            <div class="step-title">MoU</div>
          </div>
          <div class="step" data-step="4">
            <div class="step-number">4</div>
            <div class="step-title">Support Details</div>
          </div>
        </div>
      </div>
    </div>

    <!-- Removed stepper from inside the card and simplified header -->
    <div class="container registration-container">
      <form id="registrationForm">
        <!-- Step 1: Basic Information -->
        <div class="form-step active" data-step="1">
          <div class="form-row">
            <div class="form-group">
              <label for="partnerName">Partner Name *</label>
              <input type="text" id="partnerName" name="partnerName" required />
            </div>
            <div class="form-group">
              <label for="acronym">Acronym</label>
              <input type="text" id="acronym" name="acronym" />
            </div>
          </div>

          <div class="form-row">
            <div class="form-group">
              <label>Partner Type *</label>
              <div id="partnerTypeGroup">
                <label
                  ><input
                    type="radio"
                    name="partnerType"
                    value="Local"
                    required
                  />
                  Local</label
                >
                <label
                  ><input
                    type="radio"
                    name="partnerType"
                    value="International"
                    required
                  />
                  International</label
                >
              </div>
            </div>

            <div class="form-group">
              <label for="category">Category *</label>
              <select id="category" name="category" disabled>
                <option value="">Select Category</option>
              </select>
            </div>
          </div>

          <div class="form-row">
            <div class="form-group">
              <label for="officialPhone">Official Phone Number *</label>
              <input
                type="tel"
                id="officialPhone"
                name="officialPhone"
                value="+256"
                required
              />
            </div>
            <div class="form-group">
              <label for="officialEmail">Official Email *</label>
              <input
                type="email"
                id="officialEmail"
                name="officialEmail"
                required
              />
            </div>
          </div>

          <!-- Simplified address capture to single input field -->
          <div class="dynamic-section">
            <h4>Addresses</h4>
            <div id="addressesContainer">
              <div class="address-item">
                <input
                  type="text"
                  name="addresses[0]"
                  placeholder="Enter full address (e.g., 123 Main St, Kampala, Uganda)"
                  required
                />
              </div>
            </div>
            <button type="button" class="add-btn" onclick="addAddress()">
              <svg
                width="16"
                height="16"
                viewBox="0 0 24 24"
                fill="currentColor"
              >
                <path d="M19 13h-6v6h-2v-6H5v-2h6V5h2v6h6v2z" />
              </svg>
              Add Address
            </button>
          </div>
        </div>

        <!-- Step 2: Contacts -->
        <div class="form-step" data-step="2">
          <div class="dynamic-section">
            <h4>Additional Contacts</h4>
            <div id="contactsContainer">
              <div class="contact-item">
                <div class="form-row">
                  <div class="form-group">
                    <input
                      type="text"
                      name="contacts[0][name]"
                      placeholder="Contact Name *"
                      required
                    />
                  </div>
                  <div class="form-group">
                    <input
                      type="text"
                      name="contacts[0][position]"
                      placeholder="Position *"
                      required
                    />
                  </div>
                </div>
                <div class="form-row">
                  <div class="form-group">
                    <input
                      type="tel"
                      name="contacts[0][phone]"
                      placeholder="Phone Number *"
                      value="+256"
                      required
                    />
                  </div>
                  <div class="form-group">
                    <input
                      type="email"
                      name="contacts[0][email]"
                      placeholder="Email Address *"
                      required
                    />
                  </div>
                </div>
              </div>
            </div>
            <button type="button" class="add-btn" onclick="addContact()">
              <svg
                width="16"
                height="16"
                viewBox="0 0 24 24"
                fill="currentColor"
              >
                <path d="M19 13h-6v6h-2v-6H5v-2h6V5h2v6h6v2z" />
              </svg>
              Add Contact
            </button>
          </div>
        </div>

        <!-- Step 3: MoU -->
        <div class="form-step" data-step="3">
          <div class="checkbox-group">
            <input type="checkbox" id="hasMou" name="hasMou" />
            <label for="hasMou">We have an MoU with Ministry of Health</label>
          </div>

          <div class="mou-details" id="mouDetails" style="display: none">
            <div class="form-row">
              <div class="form-group">
                <label for="signedBy">Signed By (MoH Representative) *</label>
                <input type="text" id="signedBy" name="signedBy" required />
              </div>
              <div class="form-group">
                <label for="whoTitle">Title (MoH Representative) *</label>
                <input type="text" id="whoTitle" name="whoTitle" required />
              </div>
            </div>

            <div class="form-row">
              <div class="form-group">
                <label for="signedDate">Signed Date *</label>
                <input type="date" id="signedDate" name="signedDate" required />
              </div>
              <div class="form-group">
                <label for="expiryDate">Expiry Date</label>
                <input type="date" id="expiryDate" name="expiryDate" />
              </div>
            </div>

            <div class="form-group">
              <label for="mouFile">Upload MoU Document</label>
              <input
                type="file"
                id="mouFile"
                name="mouFile"
                accept="application/pdf"
              />
            </div>
          </div>
        </div>

        <!-- Step 4: Support Details -->
        <div class="form-step" data-step="4">
          <div class="dynamic-section">
            <h4>Support Details</h4>
            <div class="support-years-header">
              <button
                type="button"
                class="add-btn"
                onclick="openAddSupportYearModal()"
              >
                <svg
                  width="16"
                  height="16"
                  viewBox="0 0 24 24"
                  fill="currentColor"
                >
                  <path d="M19 13h-6v6h-2v-6H5v-2h6V5h2v6h6v2z" />
                </svg>
                Add Support Year
              </button>
            </div>
            <div
              id="supportYearsGrid"
              class="ag-theme-alpine"
              style="height: 300px; width: 100%; margin-top: 15px"
            ></div>
          </div>
        </div>

        <!-- Navigation -->
        <div class="form-navigation">
          <button
            type="button"
            class="nav-btn prev-btn"
            onclick="previousStep()"
            style="display: none"
          >
            Previous
          </button>
          <button type="button" class="nav-btn next-btn" onclick="nextStep()">
            Next
          </button>
          <button
            type="submit"
            class="nav-btn submit-btn"
            style="display: none"
          >
            Submit Registration
          </button>
        </div>
      </form>
    </div>

    <!-- Updated modal for adding support years with checkbox-based multi-selects -->
    <div id="addSupportYearModal" class="modal">
      <div class="modal-content">
        <div class="modal-header">
          <h3>Add Support Year</h3>
          <span class="close" onclick="closeAddSupportYearModal()"
            >&times;</span
          >
        </div>
        <div class="modal-body">
          <form id="supportYearForm">
            <div class="form-row">
              <div class="form-group">
                <label>Year *</label>
                <input
                  type="number"
                  id="supportYear"
                  min="2020"
                  max="2030"
                  required
                />
              </div>
              <div class="form-group">
                <label>Quarter *</label>
                <select id="quarter" required>
                  <option value="">Select Quarter *</option>
                  <option value="First">First</option>
                  <option value="Second">Second</option>
                  <option value="Third">Third</option>
                  <option value="Fourth">Fourth</option>
                </select>
              </div>
              <div class="form-group">
                <label>Level of Support *</label>
                <select
                  id="supportLevel"
                  required
                  onchange="handleModalLevelChange()"
                >
                  <option value="">Select Level</option>
                  <option value="National">National</option>
                  <option value="District">District</option>
                </select>
              </div>
            </div>

            <!-- Updated thematic areas to be checkbox container -->
            <div class="form-group">
              <label>Thematic Areas Supported *</label>
              <div id="supportThematic" class="checkbox-container">
                <!-- This will be populated by JavaScript with checkboxes -->
              </div>
            </div>

            <!-- Updated districts to single select dropdown -->
            <div class="form-group">
              <label>Districts Supported *</label>
              <div id="supportDistricts" class="checkbox-container">
                <!-- This will be populated by JavaScript with district checkboxes -->
              </div>
              <small class="district-help-text"
                >Select districts to choose subcounties</small
              >
            </div>

            <!-- Added subcounties multi-select container -->
            <div class="form-group" id="modalSubcounties" style="display: none">
              <label>Subcounties Supported *</label>
              <div id="subcountiesCheckboxes" class="checkbox-container">
                <!-- This will be populated by JavaScript with checkboxes based on selected district -->
              </div>
              <small class="subcounty-help-text"
                >Select subcounties within the chosen district</small
              >
            </div>
          </form>
        </div>
        <div class="modal-footer">
          <button
            type="button"
            class="nav-btn"
            onclick="closeAddSupportYearModal()"
          >
            Cancel
          </button>
          <button type="button" class="nav-btn" onclick="saveSupportYear()">
            Add Support Year
          </button>
        </div>
      </div>
    </div>

    <!-- Added ag-grid CDN -->
    <script src="https://cdn.jsdelivr.net/npm/ag-grid-community@31.0.0/dist/ag-grid-community.min.js"></script>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="js/register.js"></script>

    <style>
      /* Additional styles for checkbox containers and improved UI */
      .checkbox-container {
        max-height: 200px;
        overflow-y: auto;
        border: 1px solid #ced4da;
        border-radius: 4px;
        padding: 12px;
        background-color: #f8f9fa;
        margin-top: 5px;
      }

      .checkbox-item {
        margin-bottom: 8px;
        display: flex;
        align-items: center;
        gap: 8px;
        padding: 4px 0;
      }

      .checkbox-item:last-child {
        margin-bottom: 0;
      }

      .checkbox-item input[type="checkbox"] {
        width: 16px;
        height: 16px;
        accent-color: #007bff;
        cursor: pointer;
      }

      .checkbox-item label {
        margin: 0;
        cursor: pointer;
        font-size: 14px;
        color: #333;
        user-select: none;
      }

      .checkbox-item:hover {
        background-color: #e9ecef;
        border-radius: 4px;
        padding: 4px 8px;
        margin: 2px -8px;
      }

      .coverage-item {
        display: flex;
        align-items: center;
        justify-content: space-between;
        padding: 8px 0;
        border-bottom: 1px solid #e9ecef;
      }

      .coverage-item:last-child {
        border-bottom: none;
      }

      .coverage-label {
        font-weight: 500;
        color: #495057;
        min-width: 120px;
      }

      .coverage-radios {
        display: flex;
        gap: 15px;
      }

      .radio-option {
        display: flex;
        align-items: center;
        gap: 5px;
        cursor: pointer;
        font-size: 14px;
      }

      .radio-option input[type="radio"] {
        margin: 0;
        cursor: pointer;
      }

      .radio-option span {
        user-select: none;
      }

      .district-help-text,
      .subcounty-help-text {
        display: block;
        margin-top: 5px;
        font-size: 12px;
        color: #6c757d;
        font-style: italic;
      }

      /* Enhanced modal styles */
      .modal.show {
        display: flex;
        align-items: center;
        justify-content: center;
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background-color: rgba(0, 0, 0, 0.5);
        z-index: 1000;
      }

      .modal-content {
        background: white;
        border-radius: 8px;
        box-shadow: 0 4px 20px rgba(0, 0, 0, 0.15);
        max-width: 600px;
        width: 90%;
        max-height: 90vh;
        overflow-y: auto;
      }

      .modal-header {
        padding: 20px 20px 0 20px;
        border-bottom: 1px solid #dee2e6;
        display: flex;
        justify-content: space-between;
        align-items: center;
      }

      .modal-header h3 {
        margin: 0;
        color: #495057;
      }

      .modal-body {
        padding: 20px;
      }

      .modal-footer {
        padding: 0 20px 20px 20px;
        display: flex;
        justify-content: flex-end;
        gap: 10px;
        border-top: 1px solid #dee2e6;
        margin-top: 20px;
        padding-top: 20px;
      }

      .close {
        background: none;
        border: none;
        font-size: 24px;
        cursor: pointer;
        color: #adb5bd;
        padding: 0;
        width: 30px;
        height: 30px;
        display: flex;
        align-items: center;
        justify-content: center;
        border-radius: 50%;
        transition: all 0.2s;
      }

      .close:hover {
        color: #6c757d;
        background-color: #f8f9fa;
      }

      /* Responsive improvements */
      @media (max-width: 768px) {
        .modal-content {
          width: 95%;
          max-height: 95vh;
        }

        .checkbox-container {
          max-height: 150px;
        }

        .coverage-item {
          flex-direction: column;
          align-items: flex-start;
          gap: 8px;
        }

        .coverage-radios {
          width: 100%;
          justify-content: flex-start;
        }
      }

      /* Password strength indicator styles */
      .password-strength {
        margin-top: 8px;
        padding: 8px 12px;
        border-radius: 4px;
        background-color: #f8f9fa;
        font-size: 12px;
        border-left: 4px solid #dee2e6;
      }

      .password-strength ul {
        margin: 8px 0 0 0;
        padding-left: 16px;
      }

      .password-strength li {
        margin: 2px 0;
      }

      /* User creation modal styles */
      .contact-user-item {
        border: 1px solid #dee2e6;
        border-radius: 6px;
        padding: 15px;
        margin-bottom: 15px;
        background-color: #f8f9fa;
      }

      .contact-info {
        margin-bottom: 12px;
        padding-bottom: 12px;
        border-bottom: 1px solid #dee2e6;
      }

      .contact-info strong {
        color: #495057;
      }

      .contact-info small {
        color: #6c757d;
      }

      .user-creation-fields label {
        display: flex;
        align-items: center;
        gap: 8px;
        margin-bottom: 10px;
        font-weight: 500;
        cursor: pointer;
      }

      .user-fields {
        margin-top: 15px;
        padding: 15px;
        background-color: white;
        border-radius: 4px;
        border: 1px solid #dee2e6;
      }

      /* Form validation styles */
      .form-group.error input,
      .form-group.error select {
        border-color: #dc3545;
        box-shadow: 0 0 0 0.2rem rgba(220, 53, 69, 0.25);
      }

      .form-group.success input,
      .form-group.success select {
        border-color: #28a745;
        box-shadow: 0 0 0 0.2rem rgba(40, 167, 69, 0.25);
      }

      .error-message {
        color: #dc3545;
        font-size: 12px;
        margin-top: 4px;
        display: none;
      }

      .error-message.show {
        display: block;
      }

      /* Notification styles */
      .notification {
        position: fixed;
        top: 20px;
        right: 20px;
        padding: 12px 20px;
        border-radius: 6px;
        color: white;
        font-weight: 500;
        z-index: 1000;
        max-width: 400px;
        word-wrap: break-word;
      }

      .notification.success {
        background: #28a745;
      }

      .notification.error {
        background: #dc3545;
      }

      .notification.info {
        background: #007bff;
      }
    </style>
  </body>
</html>
